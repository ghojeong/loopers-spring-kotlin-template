# 요구사항 명세

이커머스 시스템의 상품, 브랜드, 좋아요, 주문 도메인에 대한 기능 요구사항을 정리

## 유비쿼터스 언어

| 한글 | 영문 | 설명 |
| --- | --- | --- |
| 사용자 | User | 시스템을 이용하는 고객 |
| 상품 | Product | 구매 가능한 아이템 |
| 브랜드 | Brand | 상품을 제공하는 브랜드 |
| 좋아요 | Like | 사용자가 상품에 표시하는 관심 표시 |
| 주문 | Order | 사용자의 상품 구매 요청 |
| 주문 항목 | OrderItem | 주문에 포함된 개별 상품 정보 |
| 재고 | Stock | 상품의 판매 가능 수량 |
| 포인트 | Point | 결제에 사용되는 가상 화폐 |
| 가격 | Price | 상품의 금액 |

## 도메인별 요구사항

### 1. 브랜드 & 상품 조회

#### 1.1 브랜드 정보 조회

- **유저 스토리**
  - 사용자는 특정 브랜드의 정보를 조회할 수 있다.
- **기능 흐름**
  - 브랜드 ID로 브랜드 정보를 조회한다.
  - 브랜드가 존재하지 않으면 404 에러를 반환한다.
  - 브랜드 정보(ID, 이름 등)를 반환한다.
- **제약사항**
  - 존재하지 않는 브랜드 조회 시 적절한 에러 메시지 제공

#### 1.2 상품 목록 조회

- **유저 스토리**
  - 1. 사용자는 상품 목록을 페이징하여 조회할 수 있다.
  - 2. 사용자는 특정 브랜드의 상품만 필터링할 수 있다.
  - 3. 사용자는 최신순, 가격순, 좋아요순으로 정렬할 수 있다.
- **기능 흐름**
  - 1. 요청 파라미터를 검증한다.
    - brandId (선택): 특정 브랜드 필터링
    - sort (필수): latest / price_asc / likes_desc
    - page (기본값 0): 페이지 번호
    - size (기본값 20): 페이지당 상품 수
  - 2. 조건에 맞는 상품 목록을 조회한다.
  - 3. 각 상품의 총 좋아요 수를 포함하여 반환한다.
- **제약사항**
  - 정렬 기준은 latest, price_asc, likes_desc만 지원
  - 페이징 정보(전체 개수, 현재 페이지 등) 포함

#### 1.3 상품 상세 조회

- **유저 스토리**
  - 사용자는 특정 상품의 상세 정보를 조회할 수 있다.
- **기능 흐름**
  - 1. 상품 ID로 상품 정보를 조회한다.
  - 2. 상품이 존재하지 않으면 404 에러를 반환한다.
  - 3. 상품 상세 정보(ID, 이름, 가격, 브랜드, 재고, 총 좋아요 수)를 반환한다.
- **제약사항**
  - 총 좋아요 수를 포함하여 반환
  - 현재 재고 수량 정보 포함

### 2. 좋아요 (Like)

#### 2.1 상품 좋아요 등록

- **유저 스토리**
  - 로그인한 사용자는 상품에 좋아요를 등록할 수 있다.
  - 이미 좋아요한 상품에 다시 좋아요를 시도하면 멱등하게 동작한다.
- **기능 흐름**
  - 1. X-USER-ID 헤더로 사용자를 식별한다.
  - 2. 상품 ID로 상품의 존재 여부를 확인한다.
  - 3. 해당 사용자의 좋아요 기록이 이미 존재하는지 확인한다.
  - 4. 존재하지 않으면 좋아요를 저장한다.
  - 5. 이미 존재하면 중복 등록하지 않는다 (멱등성).
- **제약사항**
  - 사용자당 상품당 1개의 좋아요만 가능
  - 멱등성 보장: 동일 요청 반복 시 중복 생성 없음
  - 존재하지 않는 상품에 대한 좋아요는 불가능

#### 2.2 상품 좋아요 취소

- **유저 스토리**
  - 로그인한 사용자는 좋아요를 취소할 수 있다.
  - 좋아요하지 않은 상품에 대해 취소를 시도하면 멱등하게 동작한다.
- **기능 흐름**
  - 1. X-USER-ID 헤더로 사용자를 식별한다.
  - 2. 상품 ID로 상품의 존재 여부를 확인한다.
  - 3. 해당 사용자의 좋아요 기록을 조회한다.
  - 4. 존재하면 좋아요를 삭제한다.
  - 5. 존재하지 않으면 아무 동작도 하지 않는다 (멱등성).
- **제약사항**
  - 멱등성 보장: 동일 요청 반복 시 에러 없음
  - 존재하지 않는 상품에 대한 취소 요청 시 적절한 처리

#### 2.3 좋아요한 상품 목록 조회

- **유저 스토리**
  - 로그인한 사용자는 자신이 좋아요한 상품 목록을 조회할 수 있다.
- **기능 흐름**
  - 1. X-USER-ID 헤더로 사용자를 식별한다.
  - 2. 해당 사용자가 좋아요한 상품 목록을 조회한다.
  - 3. 상품 정보와 함께 페이징 처리하여 반환한다.
- **제약사항**
  - 페이징 처리 지원
  - 좋아요한 순서(최신순) 정렬

### 3. 주문 / 결제 (Orders)

#### 3.1 주문 생성

- **유저 스토리**
  - 로그인한 사용자는 여러 상품을 한 번에 주문할 수 있다.
  - 주문 시 재고가 부족하면 주문이 실패한다.
  - 주문 시 보유 포인트가 부족하면 주문이 실패한다.
  - 주문 정보는 외부 시스템으로 전송된다.
- **기능 흐름**
  - 1. X-USER-ID 헤더로 사용자를 식별한다.
  - 2. 주문 요청을 검증한다.
    - 주문 항목이 1개 이상인지 확인
    - 각 상품의 수량이 1개 이상인지 확인
  - 3. 각 상품의 재고를 확인한다.
    - 재고가 부족하면 주문 실패 (400 에러)
  - 4. 총 주문 금액을 계산한다.
  - 5. 사용자의 보유 포인트를 확인한다.
    - 포인트가 부족하면 주문 실패 (400 에러)
  - 6. 트랜잭션으로 다음을 처리한다:
    - 주문 정보 저장
    - 각 상품의 재고 차감
    - 사용자 포인트 차감
  - 7. 외부 시스템으로 주문 정보를 전송한다 (비동기 또는 Mock 가능).
  - 8. 주문 결과를 반환한다.
- **제약사항**
  - 재고 차감, 포인트 차감, 주문 저장은 트랜잭션으로 처리
  - 재고 부족 시 명확한 에러 메시지
  - 포인트 부족 시 명확한 에러 메시지
  - 외부 시스템 연동 실패는 별도 처리 (재시도, 보상 트랜잭션 등)
  - 동시성 제어 고려 필요 (재고 차감, 포인트 차감)
- **예외 상황**
  - 존재하지 않는 상품 주문 시도
  - 재고 부족
  - 포인트 부족
  - 외부 시스템 연동 실패

#### 3.2 주문 목록 조회

- **유저 스토리**
  - 로그인한 사용자는 자신의 주문 목록을 조회할 수 있다.
- **기능 흐름**
  - 1. X-USER-ID 헤더로 사용자를 식별한다.
  - 2. 해당 사용자의 주문 목록을 조회한다.
  - 3. 주문 기본 정보(주문 ID, 총 금액, 주문 일시 등)를 페이징하여 반환한다.
- **제약사항**
  - 페이징 처리 지원
  - 최신 주문순 정렬

#### 3.3 주문 상세 조회

- **유저 스토리**
  - 로그인한 사용자는 자신의 특정 주문의 상세 정보를 조회할 수 있다.
- **기능 흐름**
  - 1. X-USER-ID 헤더로 사용자를 식별한다.
  - 2. 주문 ID로 주문 정보를 조회한다.
  - 3. 해당 주문이 현재 사용자의 주문인지 확인한다.
    - 다른 사용자의 주문이면 403 에러 반환
  - 4. 주문 상세 정보(주문 항목, 각 항목별 상품 정보, 수량, 가격 등)를 반환한다.
- **제약사항**
  - 본인의 주문만 조회 가능
  - 주문 항목 정보 포함

## 비기능 요구사항

### 인증/인가

- 모든 API는 X-USER-ID 헤더로 사용자를 식별
- 별도의 JWT, Session 인증은 구현하지 않음

### 성능

- 상품 목록 조회 시 페이징 처리 필수
- 좋아요 수 집계는 효율적으로 처리

### 데이터 정합성

- 주문 생성 시 재고 차감, 포인트 차감은 트랜잭션으로 처리
- 동시성 제어 필요 (재고, 포인트)

### 멱등성

- 좋아요 등록/취소는 멱등하게 동작
- 동일한 요청을 여러 번 보내도 결과가 동일

### 확장성

- 외부 시스템 연동은 확장 가능하도록 설계
- 추후 쿠폰, 이벤트 등 기능 추가 고려
