# 고객/회원 정합성 검증 배치

- 개요: FIU, 금감원 자료 추출 시 회원/고객 데이터 정합성이 맞지 않는 부분이 존재할 수 있음
- 수행: 회원/고객 데이터의 정합성을 사전에 체크하는 배치 프로그램을 구현
- 결과: 신규 및 수정된 고객 정보를 대상으로 매일 정합성을 체크하여 규제 리스크를 관리

## 정합성 체크 항목

- 회원 이메일 중복
- 고객 실명번호 중복
- 고객의 회원계정 부재
- 주계정 중복
- 고객 CI 중복

### 대응사례

- 회원 이메일 중복: 동일 인물인지 확인 후, 레거시 계정 때문에 중복된 회원 계정이 존재함을 확인
- 고객 실명번호 중복: 동일 인물인지 확인 후 과거 계정 제거 조치
- 고객의 회원계정 부재: 회원계정이 부재한 고객의 강제 탈퇴처리를 하도록 조치

### 배치 성능 최적화

- 락과 트랜잭션으로 인한 실서비스 영향을 JDBC 옵션(READ_ONLY, TYPE_FORWARD_ONLY)으로 방지
- 커서 기반 데이터 순회로 메모리 사용량과 연산 성능을 개선
- 결과: 일일 배치 작업 시간을 30분에서 3분 내외로 단축

### 설명

고객 확인에 문제가 생기면 빗썸 서비스 이용이 불가하여,
나쁜 사용자 경험이 발생합니다.
이를 고객이 경험하기 전에 방지할 수 있도록,
고객 확인 문제의 원인이 되는 정합성을 미연에 체크하는
배치 개발에 참여했습니다.

### 기여내용

- 6백만 고객과 천5십만 회원계정의 정합성 체크 배치를 설계 후 개발했습니다.
- 정합성에 문제가 있을 시 Slack 알림을 보내도록 하였습니다.
- 정합성 체크 전략을 책임연쇄 디자인패턴으로 설계하여, 정합성 로직의 확장성에 대비했습니다.
- JDBCTemplate 의 READ_ONLY 옵션을 활용하여 row 혹은 table 단위의 락을 방지하였습니다.
- 페이지가 아닌 커서 기반으로 처리하여, 대규모 데이터처리에도 서버 메모리 낭비나, DB 성능 낭비가 없도록 했습니다.
